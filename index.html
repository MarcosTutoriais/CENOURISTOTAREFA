<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>C.V.A | Auto Tarefas</title>
  <style>
    body {
      margin:0;
      font-family:"Segoe UI",Arial,sans-serif;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      color:#fff;
      background: radial-gradient(circle at center, #000000 40%, #0a0a0a 100%);
      overflow: hidden;
    }

    canvas#snow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .container{
      position: relative;
      text-align:center;
      background:rgba(255,255,255,0.08);
      border:2px solid rgba(255,255,255,0.2);
      backdrop-filter:blur(15px);
      padding:40px;
      border-radius:20px;
      box-shadow:0 0 40px rgba(0,0,0,0.9);
      width:90%;
      max-width:350px;
      transition: box-shadow 0.3s ease-in-out;
      z-index: 1;
    }
    .container:hover{
      box-shadow:0 0 60px rgba(255,0,0,0.5), 0 0 100px rgba(0,80,255,0.5);
    }

    .logo-imagem {
  width: 150px;
  height: 150px; /* for√ßa ficar quadrada */
  object-fit: cover; /* garante que n√£o distorce */
  border-radius: 20%; /* deixa redonda */
  margin-bottom: 20px;
  box-shadow: 0 0 15px rgba(255,0,0,0.7), 0 0 25px rgba(0,80,255,0.7);
  animation: glow 2s ease-in-out infinite alternate;
}
    @keyframes glow {
      from { box-shadow:0 0 15px rgba(255,0,0,0.7),0 0 25px rgba(0,80,255,0.7); }
      to { box-shadow:0 0 35px rgba(255,0,0,1),0 0 55px rgba(0,80,255,1); }
    }

    h1 {margin-bottom:5px;font-weight:600;letter-spacing:1px;}
    p {margin-bottom:20px;color:#ccc;font-size:0.9em;}

    .input-group input{
      padding:12px;margin:10px 0;width:100%;
      border:none;border-radius:8px;outline:none;
      background:rgba(255,255,255,0.15);color:white;font-size:1em;
      transition:0.3s;
    }
    .input-group input:focus{background:rgba(255,255,255,0.3);}

    .entrar input[type="submit"]{
      margin-top:20px;padding:12px 25px;width:100%;font-size:1em;font-weight:bold;
      cursor:pointer;border:none;border-radius:8px;
      background:linear-gradient(90deg,#e60000,#0051ff);color:white;
      box-shadow:0 5px 15px rgba(0,0,0,0.7);
      transition:transform 0.3s, box-shadow 0.3s;
    }
    .entrar input[type="submit"]:hover{
      transform:scale(1.05);
      box-shadow:0 0 25px rgba(255,0,0,0.7),0 0 40px rgba(0,80,255,0.7);
    }

    #loading-screen{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.9);color:white;
      display:none;justify-content:center;align-items:center;z-index:9999;
    }
    .loading-container{text-align:center;animation:fadeIn 0.5s ease-in-out;}
    .loading-container p{font-size:1.3em;margin-bottom:20px;}
    .loading-container img{width:80px;animation:spin 2s linear infinite;}
    @keyframes spin{100%{transform:rotate(360deg);}}
    @keyframes fadeIn{from{opacity:0;transform:scale(0.8);}to{opacity:1;transform:scale(1);}}

    #toasts{
      position:fixed;top:20px;right:20px;display:flex;
      flex-direction:column;gap:10px;z-index:10000;
    }
    .toast{
      background:rgba(30,30,30,0.95);color:white;padding:15px 20px;
      border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.5);
      font-size:0.9em;min-width:220px;max-width:320px;
      animation:popIn 0.4s ease forwards;
    }
    .toast.success{border-left:5px solid #00ff88;}
    .toast.error{border-left:5px solid #e60000;}
    .toast.info{border-left:5px solid #0051ff;}
    @keyframes popIn{
      from{opacity:0;transform:translateX(100%) scale(0.9);}
      to{opacity:1;transform:translateX(0) scale(1);}
    }
  </style>
</head>
<body>
  <canvas id="snow"></canvas>

  <div class="container">
    <img src="https://i.imgur.com/5nmqcOu.jpeg" alt="Logo Script Lab" class="logo-imagem">
    <h1>CENOURISTOS CVA</h1>
    <p>Sala do Futuro ‚Äì CMSP Web</p>
    <div class="input-group"><input id="ra" type="text" placeholder="RA" required></div>
    <div class="input-group"><input id="senha" type="password" placeholder="Senha" required></div>
    <div class="entrar"><input type="submit" value="Entrar"></div>
  </div>

  <div id="loading-screen">
    <div class="loading-container">
      <p id="loading-msg">üîÑ Carregando...</p>
      <img src="https://i.imgur.com/5nmqcOu.jpeg" alt="Carregando...">
    </div>
  </div>
  <div id="toasts"></div>

  <audio id="notif-sound" src="https://www.soundjay.com/buttons/sounds/button-29.mp3" preload="auto"></audio>

  <script>
   

// === NEVE ===
const canvas = document.getElementById('snow');
const ctx = canvas.getContext('2d');
let flakes = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function createFlakes() {
  for (let i = 0; i < 100; i++) {
    flakes.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      radius: Math.random() * 4 + 1,
      speed: Math.random() * 1 + 0.5
    });
  }
}
function drawFlakes() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "white";
  ctx.beginPath();
  for (let flake of flakes) {
    ctx.moveTo(flake.x, flake.y);
    ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
  }
  ctx.fill();
  moveFlakes();
}
function moveFlakes() {
  for (let flake of flakes) {
    flake.y += flake.speed;
    if (flake.y > canvas.height) {
      flake.y = -flake.radius;
      flake.x = Math.random() * canvas.width;
    }
  }
}
function snowLoop() {
  drawFlakes();
  requestAnimationFrame(snowLoop);
}
createFlakes();
snowLoop();

// === NOTIFICA√á√ïES & LOGIN ===
const API = {
  registroToken: "https://edusp-api.ip.tv/registration/edusp/token",
  listUsers: "https://edusp-api.ip.tv/room/user?list_all=true&with_cards=true",
  tarefasExpiradas: room => `https://edusp-api.ip.tv/tms/task/todo?expired_only=true&filter_expired=false&with_answer=true&is_essay=false&publication_target=${room}&answer_statuses=pending&with_apply_moment=true`,
  tarefasPendentes: room => `https://edusp-api.ip.tv/tms/task/todo?expired_only=false&filter_expired=true&with_answer=true&is_essay=false&publication_target=${room}&answer_statuses=pending&with_apply_moment=false`,
  responderTarefa: taskId => `https://edusp-api.ip.tv/tms/task/${taskId}/answer`
};

function toast(msg,type="info"){
  const div=document.createElement("div");
  div.className=`toast ${type}`;
  div.textContent=msg;
  document.getElementById("toasts").appendChild(div);
  document.getElementById("notif-sound").play();
  setTimeout(()=>div.remove(),4000);
}

async function loginEDUSP(ra, senha){
  toast("Iniciando login...","info");
  const res = await fetch(API.registroToken, {
    method: "POST", headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ username: ra, password: senha })
  });
  if(!res.ok) throw new Error("Login falhou");
  toast("Login realizado com sucesso!","success");
  return await res.json();
}

async function getRoom(token){
  const res = await fetch(API.listUsers, { headers: { Authorization: `Bearer ${token}` }});
  const data = await res.json();
  return data?.rooms?.length ? data.rooms[0].code : null;
}

async function completarTarefas(token, room) {
  const headers = { Authorization: `Bearer ${token}`, "Content-Type": "application/json" };
  const fetchTasks = async (url) => (await fetch(url, { headers })).json();

  const expiradas = await fetchTasks(API.tarefasExpiradas(room));
  const pendentes = await fetchTasks(API.tarefasPendentes(room));
  const todas = [...(expiradas.tasks || []), ...(pendentes.tasks || [])];

  if (todas.length === 0) {
    toast("Nenhuma atividade encontrada!", "error");
    return 0;
  }

  for (const task of todas) {
    try {
      // Pega modelo de quest√£o
      const modeloResp = await fetch(API.responderTarefa(task.id), { headers });
      const modelo = await modeloResp.json();

      // Preenche respostas autom√°ticas v√°lidas
      const respostas = (modelo.questions || []).map(q => ({
        questionId: q.id,
        value: q.options?.[0]?.value ?? "Resposta autom√°tica"
      }));

      // Envia resposta como conclu√≠da 100%
      const resp = await fetch(API.responderTarefa(task.id), {
        method: "POST",
        headers,
        body: JSON.stringify({ answers: respostas, status: "done" })
      });

      if (!resp.ok) {
        toast(`Erro ao concluir tarefa ${task.title || task.id}`, "error");
      } else {
        toast(`Tarefa ${task.title || task.id} conclu√≠da com 100%`, "success");
      }
    } catch (e) {
      toast(`Erro na tarefa ${task.title || task.id}`, "error");
      console.error(e);
    }
  }
  return todas.length;
}

document.querySelector('.entrar input[type="submit"]').addEventListener('click', async () => {
  const ra = document.getElementById("ra").value.trim();
  const senha = document.getElementById("senha").value;
  if (!ra || !senha) return toast("Preencha RA e Senha!", "error");

  document.getElementById("loading-screen").style.display = "flex";
  try {
    const tokenData = await loginEDUSP(ra, senha);
    const token = tokenData.access_token;
    const room = await getRoom(token);
    if (!room) {
      toast("Sala n√£o encontrada.", "error");
      document.getElementById("loading-screen").style.display = "none";
      return;
    }
    const feitas = await completarTarefas(token, room);
    if (feitas > 0) {
      toast(`Processo finalizado: ${feitas} tarefas feitas!`, "success");
    }
  } catch (e) {
    toast("Erro ao logar ou concluir tarefas!", "error");
    console.error(e);
  }
  document.getElementById("loading-screen").style.display = "none";
});
    </script>
  
  
  <style>
  #doacao * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  #doacao {
    font-family: 'Segoe UI', sans-serif;
    background: #121212;
    color: #fff;
    overflow-x: hidden;
  }

  #doacao .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9998;
  }

  #doacao .donation-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1f1f1f;
    padding: 20px;
    border-radius: 16px;
    width: 320px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    text-align: center;
    z-index: 9999;
    animation: popup 0.3s ease;
    overflow-y: auto;
  }

  #doacao .header-panel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  #doacao .header-panel h2 {
    font-size: 20px;
    color: #4da6ff;
    margin-left: 50px;
    font-weight: bold;
  }

  #doacao .close-btn {
    font-size: 24px;
    color: #fff;
    cursor: pointer;
    margin-left: 9px;
  }

  #doacao .donation-panel p {
    font-size: 14px;
    color: #ddd;
    margin-bottom: 14px;
    line-height: 1.6;
  }

  #doacao .donation-panel a {
    color: #4da6ff;
    font-size: 16px;
    text-decoration: none;
    display: inline-block;
    position: relative;
    top: -10px;
    font-weight: bold;
    transition: color 0.3s;
  }

  #doacao .donation-panel a:hover {
    color: #4da6ff;
    text-decoration: underline;
  }

  #doacao button {
    background-color: #0000ff;
    color: #fff;
    font-size: 16px;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  #doacao button:hover {
    background-color: #4da6ff;
  }

  @keyframes popup {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
</style>

<div id="doacao">
  <div class="overlay" id="overlay"></div>
  <div class="donation-panel" id="donationPanel">
    <div class="header-panel">
      <h2>Apoie este Projeto!</h2>
      <span class="close-btn" onclick="fecharPainel()">√ó</span>
    </div>
    <p>Ajude a manter nosso sistema gratuito, r√°pido e est√°vel para todos os usu√°rios. Toda ajuda √© bem-vinda!</p>
    <p>Com sua doa√ß√£o, conseguimos manter o projeto online e atualizado constantemente.</p>   
    <a href="https://discord.gg/48Wa95KfPr" target="_blank">SHOOL BOTS CVA</a>
    <button onclick="fazerDoacao()">Fazer uma Doa√ß√£o</button>
  </div>
</div>

<script>
  function fecharPainel() {
    document.getElementById('donationPanel').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
  }
  function fazerDoacao() {
    alert("Voc√™ ser√° redirecionado para o link de doa√ß√£o.");
    window.open("https://pix.example.com", "_blank");
  }
</script>
